<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
/*
 * Overrided Sencha Platform utilities using Unity Platform.
 */
Ext.is = Unity.is;

<span id='global-method-refreshOrientation'>/**
</span> * @ignore
 * METHOD OVERRIDDEN FROM unity.js FILE. THIS IS DONE TO AVOID ONCHANGEORIENTATION LAYOUT ERRORS FOR ALL APPLICATIONS.
 * Related JIRA ticket (APPSENCHAUI-6)
 * @method
 * @version 2.1
 */
var refreshOrientation = function() {
	Ext.getBody().setWidth(window.innerWidth);
	Ext.getBody().setHeight(window.innerHeight);
	Unity.setOrientationChange( Unity.getCurrentOrientation() , window.innerWidth , window.innerHeight );
}

// FIX ERROR ON SENCHA 1.1.0.. view port is not correctly being applied for android tablets (window.orientation has no the expected values)
Ext.Viewport.getOrientation = function() {
	var size = this.getSize();
	//console.log(&quot;***** viewport OVERRIDED getOrientation() method sw:&quot; + size.width + &quot;- sh: &quot; + size.height+ &quot;slw:&quot; + this.lastSize.width + &quot;- slh: &quot; + this.lastSize.height + &quot;this.orientation: &quot; + this.orientation);
	//console.log(&quot;***** viewport OVERRIDED getOrientation(), window.orientation: &quot; + window.orientation);
	if (window.hasOwnProperty('orientation')) {
		//console.log(&quot;***** viewport OVERRIDED getOrientation() method hasOwnProperty, window.orientation: &quot; + window.orientation);
		if(Ext.is.Android &amp;&amp; Ext.is.Tablet) {
			return (window.orientation == 90 || window.orientation == -90) ? 'portrait' : 'landscape';
		}
	    return (window.orientation == 0 || window.orientation == 180) ? 'portrait' : 'landscape';
    }
    else {
        if (!Ext.is.iOS &amp;&amp; !Ext.is.Desktop) {
            if ((size.width == this.lastSize.width &amp;&amp; size.height &lt; this.lastSize.height) ||
                (size.height == this.lastSize.height &amp;&amp; size.width &lt; this.lastSize.width)) {
				//console.log(&quot;***** viewport OVERRIDED getOrientation() method this.orientation: &quot; + this.orientation);
                return this.orientation;
            }
        }
		//console.log(&quot;***** viewport OVERRIDED getOrientation(): H:&quot; + window.innerHeight +&quot;- W:&quot;+ window.innerWidth );
		return (window.innerHeight &gt; window.innerWidth) ? 'portrait' : 'landscape';
    }

}

/*
 * Namespace for all Unity Sencha UI components.
 */
Ext.ns('Unity.ui');

<span id='Unity-ui-UniversalUI'>/**
</span> * @class Unity.ui.UniversalUI
 * @namespace Unity.ui
 * @extends Ext.Panel
 * Universal UI component. Different behaviour on Phone - iPhone, Android, etc - than on Tablet - iPad, etc. &lt;br/&gt;
 * @author Marga Parets maps@gft.com
 * @version 1.0
 */
Unity.ui.UniversalUI = Ext.extend(Ext.Panel, {
<span id='Unity-ui-UniversalUI-cfg-fullscreen'>    /**
</span>     * @cfg {Boolean} fullscreen Force the component to take up 100% width and height available. Defaults to true.
     */
    fullscreen: true,
<span id='Unity-ui-UniversalUI-cfg-layout'>    /**
</span>     * @cfg {String/Object} layout Specify the layout manager to be used. Defaults to 'card'. 
     */
    layout: 'card',
<span id='Unity-ui-UniversalUI-cfg-backText'>    /**
</span>     * @cfg {String} backText The default text for the navigation back button. Defaults to 'Back'.
     */
    backText: 'Back',
<span id='Unity-ui-UniversalUI-cfg-navigationText'>    /**
</span>     * @cfg {String} navigationText The default text for the navigation button (only visible for Table landscape mode). Defaults to 'Navigation'.
     */
    navigationText: 'Navigation',
<span id='Unity-ui-UniversalUI-cfg-useTitleAsBackText'>    /**
</span>     * @cfg {Boolean} useTitleAsBackText Set this configuration property as false to use the default back  text (see {@link Unity.ui.UniversalUI#backText backText})as the Back button inner text, or set it as false to use parent card title. Defaults to false.
     */
    useTitleAsBackText: false,
<span id='Unity-ui-UniversalUI-cfg-navigationPanelWidth'>    /**
</span>     * @cfg {Number} navigationPanelWidth The width (in pixels) of the navigation panel to be shown on Tablet case. 
     */
    navigationPanelWidth: 250,
<span id='Unity-ui-UniversalUI-cfg-navigationPanelWidth'>    /**
</span>     * @cfg {Number} navigationPanelWidth The height (in pixels) of the navigation panel to be shown on Tablet case. 
     */
    navigationPanelHeight: 500,
<span id='Unity-ui-UniversalUI-method-initComponent'>    /**
</span>     * Component initialization method.
     */
    initComponent : function() {
<span id='Unity-ui-UniversalUI-property-navigationButton'>        /**
</span>         * @property navigationButton The Navigation button on the Navigation Bar (only visible for Table landscape mode).
         * @type Ext.Button
         */
    	this.navigationButton = new Ext.Button({
            hidden: Ext.is.Phone || Ext.orientation == 'landscape',
            text: this.navigationText,
            handler: this.onNavButtonTap,
            scope: this
        });
        
<span id='Unity-ui-UniversalUI-property-backButton'>        /**
</span>         * @property backButton The Back button on the Navigation Bar.
         * @type Ext.Button
         */
        this.backButton = new Ext.Button({
            hidden: true,
            text: this.backText,
            handler: this.onBackButtonTap,
            hidden: true,
            scope: this
        });
        
        var btns = [this.navigationButton];
        if (Ext.is.Phone) {
            btns.unshift(this.backButton);
        }
        
<span id='Unity-ui-UniversalUI-property-navigationBar'>        /**
</span>         * @property navigationBar The Navigation Bar component rendered as a Top Light Toolbar.
         * @type Ext.Toolbar
         */
        this.navigationBar = new Ext.Toolbar({
            ui: 'light',
            dock: 'top',
            title: this.title,
            items: btns.concat(this.buttons || [])
        });
        
<span id='Unity-ui-UniversalUI-property-navigationPanel'>        /**
</span>         * @property navigationPanel &lt;p&gt;The Navigation Panel used as the component navigation menu. It is not always visible on screen, depends on device model and orientation.&lt;/p&gt;
         * &lt;div class=&quot;mdetail-params&quot;&gt;This panel is shown as:&lt;ul&gt;
         * &lt;li&gt;'left docked' panel for Tablet Landscape devices.&lt;/li&gt;
         * &lt;li&gt;'floatable' panel for Tablet Portrait devices - when user clicks on navigation button.&lt;/li&gt;
         * &lt;li&gt;'fullscreeen' scrollable panel for Phone devices.&lt;/li&gt;
         *&lt;/ul&gt;&lt;/div&gt;
         * @type Ext.Panel
         */
        this.navigationPanel = new Ext.Panel({
		    layout: 'fit',
		    dock: 'left',
		    listeners: {
<span id='Unity-ui-UniversalUI-event-listchange'>                /**
</span>                 * @event listchange Fires when user changes selection on main navigation panel items list.
                 * @param {Ext.util.MixedCollection} list The current navigation panel items list.
                 * @param {Ext.Component} item The item to be displayed configured as: {card:{@link Ext.Component Ext.Component} - the component to be displayed, text:{@link String String} - the title of navigation bar when component is displayed}.
                 */
                listchange: this.onListChange,
                scope: this
            },
            title: this.title,
            items: this.items || []
		});
		
		if (!Ext.is.Phone) {
            this.navigationPanel.setWidth(this.navigationPanelWidth);
        }
        
        this.defaultDockedToolbar = new Ext.Toolbar({
			        xtype: 'toolbar',
			        ui: 'light',
			        dock: 'top'
				});
        
        this.dockedItems = this.dockedItems || [];
        this.dockedItems.unshift(this.navigationBar);
        
        if (!Ext.is.Phone &amp;&amp; Ext.orientation == 'landscape') { 
            this.navigationPanel.insertDocked(0, this.defaultDockedToolbar);
            this.dockedItems.unshift(this.navigationPanel);
            this.items = [this.tabletLandscapeLaunchScreen || {}];
        }
        else if (Ext.is.Phone) {
            this.items = [];
            this.items.unshift(this.navigationPanel);
        } else {
        	this.navigationPanel.hide();
        	this.navigationPanel.setFloating(true);
        	this.navigationPanel.setHeight(this.navigationPanelHeight);
        	this.items = [this.tabletLandscapeLaunchScreen || {}];
        }
        
        this.addEvents(
<span id='Unity-ui-UniversalUI-event-navigate'>            /**
</span>             * @event navigate Fires when user navigates through this UniversalUI component elements - forward or backward
             * @param {Unity.ui.UniversalUI} this
             * @param {Ext.data.Record} record The list record this component is navigating to.
             */
            'navigate'
        );
        Unity.ui.UniversalUI.superclass.initComponent.call(this);
    },
    
<span id='Unity-ui-UniversalUI-method-onListChange'>    onListChange : function(list, item) {
</span>    	if (Ext.getOrientation() == 'portrait' &amp;&amp; !Ext.is.Phone &amp;&amp; !item.items &amp;&amp; !item.preventHide) {
        	this.navigationPanel.hide();
        }
        
        if (item.card) {
        	var backButtonText = item.card.parentTitle;
        	this.setActiveItem(item.card, item.animation || 'slide');
            this.currentCard = item.card;
            if (item.text) {
                this.navigationBar.setTitle(item.text);
            }
            if (Ext.is.Phone) {
            	if(this.useTitleAsBackText) {
            		this.backButton.setText(backButtonText);
            	}
                this.backButton.show();
                this.navigationBar.doLayout();
            }
        }     
       
        this.fireEvent('navigate', this, item, list);
    },
    
<span id='Unity-ui-UniversalUI-method-onNavButtonTap'>    onNavButtonTap : function() {
</span>        this.navigationPanel.showBy(this.navigationButton, 'fade');
    },
    
<span id='Unity-ui-UniversalUI-method-onBackButtonTap'>    onBackButtonTap : function() {
</span>    	
    	this.setActiveItem(this.navigationPanel, {type: 'slide', direction: 'right'});
        this.currentCard = this.navigationPanel;
        if (Ext.is.Phone) {
            this.backButton.hide();
            this.navigationBar.setTitle(this.currentCard.title);
            this.navigationBar.doLayout();
        }
        
        this.fireEvent('navigate', this, this.navigationPanel.activeItem, this.navigationPanel);
    },
    
<span id='Unity-ui-UniversalUI-method-layoutOrientation'>    layoutOrientation : function(orientation, w, h) {
</span>        if (!Ext.is.Phone) {
			
			if (orientation == 'portrait') {
                this.navigationPanel.hide(false);
				try {
					// prevent errors when removing docked items not already docked
					this.removeDocked(this.navigationPanel, false);
				}	catch(e) {
					console.log(&quot;WARNING on UnityVersalUI layoutOrientation() method: &quot;+e);
				}
				
				if (this.navigationPanel.rendered) {
                    this.navigationPanel.el.appendTo(document.body);
                }
                this.navigationPanel.setFloating(true);
                this.navigationPanel.setHeight(this.navigationPanelHeight);
                if(this.navigationPanel.getDockedItems() &amp;&amp; this.navigationPanel.getDockedItems().length&gt;0) {
					this.navigationPanel.removeDocked(this.defaultDockedToolbar, false);
				}
				this.navigationButton.show(false);
            }
            else {
                if(!this.navigationPanel.getDockedItems() || this.navigationPanel.getDockedItems().length&lt;=0) {
            		this.navigationPanel.insertDocked(0, this.defaultDockedToolbar);
				}
				this.navigationPanel.setFloating(false);
                this.navigationPanel.show(false);
                this.navigationButton.hide(false);
                this.insertDocked(0, this.navigationPanel);
            }
            this.navigationBar.doComponentLayout();
        }
		
        Unity.ui.UniversalUI.superclass.layoutOrientation.call(this, orientation, w, h);
    }
});

Ext.apply(Ext.anims, {
    rotate: new Ext.Anim({
        autoClear: false,
        out: false,
        before: function(el) {
            var d = '';
            if (this.dir == 'ccw'){
              d = '-';
            }

            this.from = {
                '-webkit-transform': 'rotate('+d+''+this.fromAngle+'deg)'
            };

            this.to = {
                '-webkit-transform': 'rotate('+d+''+this.toAngle+'deg)'
            };
                        
        }
    })
}); 

<span id='Unity-ui-ListPullRefresh'>/**
</span> * @class Unity.ui.ListPullRefresh
 * @namespace Unity.ui
 * @extends Ext.util.Observable
 * A plugin to add 'Pull to Refresh' functionality to a List component or just for a panel. &lt;br/&gt;
 * @author Marga Parets maps@gft.com
 * @version 2.0
 */
Unity.ui.ListPullRefresh = Ext.extend(Ext.util.Observable, {
<span id='Unity-ui-ListPullRefresh-method-constructor'>  constructor: function(config){
</span>    Ext.apply(this,config);
    this.addEvents({
      'released': true
    });
    Unity.ui.ListPullRefresh.superclass.constructor.call(this, config);
  },
<span id='Unity-ui-ListPullRefresh-cfg-langPullRefresh'>  /*
</span>   * @cfg {String} langPullRefresh The text that will be shown while you are pulling down the list or panel this plugin is added to.
   */
  langPullRefresh: 'Pull down to refresh...',
<span id='Unity-ui-ListPullRefresh-cfg-langReleaseRefresh'>  /*
</span>   * @cfg {String} langReleaseRefresh The text that will be shown after you have pulled down enough to show the release message.
   */
  langReleaseRefresh: 'Release to refresh...',
<span id='Unity-ui-ListPullRefresh-cfg-langLoading'>  /*
</span>   * @cfg {String} langLoading The text that will be shown while the list is refreshing.
  */
  langLoading: 'Loading...',
<span id='Unity-ui-ListPullRefresh-property-loading'>  loading: false,
</span><span id='Unity-ui-ListPullRefresh-method-init'>  // private
</span>  init: function(cmp){
    this.cmp = cmp;
    this.lastUpdate = new Date();
    //cmp.loadingText = undefined;
    cmp.on('render', this.initPullHandler, this);
  },
<span id='Unity-ui-ListPullRefresh-method-initPullHandler'>  // private
</span>  initPullHandler: function(){
    this.pullTpl = new Ext.XTemplate(
      '&lt;div class=&quot;pullrefresh&quot; style=&quot;height: {h}; text-align: bottom;&quot;&gt;'+
        '&lt;div class=&quot;msgwrap&quot; style=&quot;height: 75px; bottom: 0px; position: relative;&quot;&gt;'+
          '&lt;span class=&quot;arrow {s}&quot;&gt;&lt;/span&gt;'+
          '&lt;span class=&quot;msg&quot;&gt;{m}&lt;/span&gt;'+
          '&lt;span class=&quot;lastupdate&quot;&gt;Last Updated: {[Ext.util.Format.date(values.l,&quot;m/d/Y h:iA&quot;)]}&lt;/span&gt;'+
        '&lt;/div&gt;'+
      '&lt;/div&gt;');
    this.loadingTpl = new Ext.XTemplate(
      '&lt;div class=&quot;loadingspacer&quot; style=&quot;height: {h}; text-align: bottom;&quot;&gt;'+
        '&lt;div class=&quot;msgwrap&quot; style=&quot;height: 75px; bottom: 0px; position: relative;&quot;&gt;'+
          '&lt;span class=&quot;loading {s}&quot;&gt;&lt;/span&gt;'+
          '&lt;span class=&quot;msg&quot;&gt;{m}&lt;/span&gt;'+
        '&lt;/div&gt;'+
      '&lt;/div&gt;');
    this.pullEl = this.pullTpl.insertBefore(this.cmp.scroller.el, {h:0,m:this.langPullRefresh,l:this.lastUpdate}, true);
    this.pullEl.hide();
    Ext.Element.cssTranslate(this.pullEl, {x:0, y:-75});
    this.loadingEl = this.loadingTpl.insertBefore(this.pullEl, {h:0,m:this.langLoading}, true);
    this.loadingEl.hide();
    this.cmp.scroller.on('offsetchange', this.handlePull, this);
  },
<span id='Unity-ui-ListPullRefresh-method-handlePull'>  //private
</span>  handlePull: function(scroller, offset){
    if (scroller.direction === 'vertical' &amp;&amp; !this.loading){
      if (offset.y &gt; 0){
        Ext.Element.cssTranslate(this.pullEl, {x:0, y:offset.y-75});
        if (offset.y &gt; 75){
          // state 1
          if (this.state !== 1){
            this.prevState = this.state;
            this.state = 1;
            this.pullTpl.overwrite(this.pullEl, {h:offset.y,m:this.langReleaseRefresh,l:this.lastUpdate});
            Ext.Anim.run(this.pullEl.select('.arrow').first(),'rotate',{dir:'ccw',fromAngle:0,toAngle:180});
          }
        }else if (!scroller.isDragging()){
          // state 3
          if (this.state !== 3){
            this.prevState = this.state;
            this.state = 3;
            if (this.prevState == 1){
              this.loading = true;
              this.lastUpdate = new Date();
              this.pullEl.hide();
              this.loadingTpl.overwrite(this.loadingEl, {h:offset.y,m:this.langLoading});
              this.loadingEl.show();
              this.fireEvent('released',this,this.cmp);
            }
          }
        }else{
          // state 2
          if (this.state !== 2){
            this.prevState = this.state;
            this.state = 2;
            this.loadingEl.hide();
            this.pullTpl.overwrite(this.pullEl, {h:offset.y,m:this.langPullRefresh,l:this.lastUpdate});
            this.pullEl.show();
            if (this.prevState == 1){
              Ext.Anim.run(this.pullEl.select('.arrow').first(),'rotate',{dir:'cw',fromAngle:180,toAngle:0});
            }
          }
        }
      }
    }
  },
<span id='Unity-ui-ListPullRefresh-method-processComplete'>  //private
</span>  processComplete: function(){
    this.loading = false;
    this.lastUpdate = new Date();
    this.loadingTpl.overwrite(this.loadingEl, {h:0,m:this.langLoading});
    this.pullTpl.overwrite(this.pullEl, {h:0,m:this.langPullRefresh,l:this.lastUpdate});
  }
});

Ext.preg('listpullrefresh', Unity.ui.ListPullRefresh);




</pre>
</body>
</html>
